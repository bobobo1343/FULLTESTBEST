<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Spotify Clone Player</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <style>
    body {
      margin: 0;
      font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
      background-color: #000;
      color: white;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }
    .app { flex: 1; display: flex; }
    .sidebar, .queue { width: 280px; background: #000; overflow-y: auto; padding: 20px; }
    .main-content { flex: 1; display: flex; flex-direction: column; background: #121212; }
    .header, .now-playing { padding: 20px; background: #181818; }
    .header input, .playlist-input input { width: 100%; padding: 10px; background: #282828; border: none; color: white; border-radius: 20px; }
    .playlist-input button { padding: 10px; background: #1DB954; border: none; border-radius: 20px; color: white; cursor: pointer; margin-top: 10px; }
    .card { background: #181818; padding: 16px; border-radius: 8px; cursor: pointer; margin-bottom: 10px; }
    .card:hover { background: #282828; }
    .now-playing { display: flex; align-items: center; justify-content: space-between; }
    .controls button { background: none; border: none; color: white; font-size: 24px; margin: 0 10px; cursor: pointer; }
    .queue-item { margin-bottom: 10px; }
    #login-btn, #logout-btn { background: #1DB954; color: white; border: none; padding: 10px 20px; border-radius: 20px; cursor: pointer; }
  </style>
</head>
<body>
  <div class="header">
    <div id="auth-area">
      <button id="login-btn">Sign in with Google</button>
      <button id="logout-btn" style="display:none">Logout</button>
    </div>
  </div>
  <div class="app">
    <div class="sidebar">
      <h2>Your Playlists</h2>
      <div class="playlist-input">
        <input id="new-playlist-name" placeholder="New Playlist Name" />
        <button onclick="createPlaylist()">Create</button>
      </div>
      <div id="playlist-list"></div>
    </div>
    <div class="main-content">
      <div class="header">
        <input id="search" placeholder="Search songs...">
      </div>
      <div id="track-list" style="padding: 20px;"></div>
      <div class="now-playing">
        <div id="track-title">Nothing Playing</div>
        <div class="controls">
          <button onclick="prevTrack()">⏮️</button>
          <button onclick="nextTrack()">⏭️</button>
        </div>
      </div>
      <audio id="audio" controls style="width: 100%"></audio>
    </div>
    <div class="queue">
      <h3>Queue</h3>
      <div id="queue-list"></div>
    </div>
  </div>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDsYE91wH7UDwu8eZNbD1CFuVcilgYeZhI",
      authDomain: "your-app.firebaseapp.com",
      databaseURL: "https://your-app-default-rtdb.firebaseio.com",
      projectId: "your-app",
    };
    firebase.initializeApp(firebaseConfig);

    const auth = firebase.auth();
    const db = firebase.database();

    const loginBtn = document.getElementById("login-btn");
    const logoutBtn = document.getElementById("logout-btn");
    const authArea = document.getElementById("auth-area");
    const trackListDiv = document.getElementById("track-list");
    const playlistList = document.getElementById("playlist-list");
    const audio = document.getElementById("audio");
    const title = document.getElementById("track-title");

    let user = null;
    let tracks = [];
    let currentTrack = 0;

    const folderId = '1DGz9zEQh29EAqTZpmWK5mwSj5HComnkn';
    const apiKey = firebaseConfig.apiKey;

    function login() {
      const provider = new firebase.auth.GoogleAuthProvider();
      auth.signInWithPopup(provider);
    }

    function logout() {
      auth.signOut();
    }

    loginBtn.onclick = login;
    logoutBtn.onclick = logout;

    auth.onAuthStateChanged(u => {
      if (u) {
        user = u;
        loginBtn.style.display = 'none';
        logoutBtn.style.display = 'inline-block';
        loadAllTracks();
        loadPlaylists();
      } else {
        user = null;
        loginBtn.style.display = 'inline-block';
        logoutBtn.style.display = 'none';
        trackListDiv.innerHTML = '';
        playlistList.innerHTML = '';
      }
    });

    function loadPlaylists() {
      const ref = db.ref(`users/${user.uid}/playlists`);
      ref.on('value', snap => {
        playlistList.innerHTML = '';
        const data = snap.val() || {};
        Object.keys(data).forEach(name => {
          const btn = document.createElement('button');
          btn.textContent = `${name} (${data[name].public ? 'Public' : 'Private'})`;
          btn.onclick = () => {
            tracks = data[name].tracks || [];
            renderTracks();
          };
          const toggle = document.createElement('button');
          toggle.textContent = 'Toggle';
          toggle.onclick = () => {
            db.ref(`users/${user.uid}/playlists/${name}/public`).set(!data[name].public);
          };
          const wrap = document.createElement('div');
          wrap.appendChild(btn);
          wrap.appendChild(toggle);
          playlistList.appendChild(wrap);
        });
      });
    }

    function createPlaylist() {
      const name = document.getElementById('new-playlist-name').value.trim();
      if (!name || !user) return;
      db.ref(`users/${user.uid}/playlists/${name}`).set({ public: false, tracks: [] });
      document.getElementById('new-playlist-name').value = '';
    }

    function renderTracks() {
      trackListDiv.innerHTML = '';
      tracks.forEach((track, i) => {
        const div = document.createElement('div');
        div.className = 'card';
        div.textContent = track.name;
        div.onclick = () => playTrack(i);
        trackListDiv.appendChild(div);
      });
    }

    function playTrack(index) {
      const track = tracks[index];
      currentTrack = index;
      title.textContent = track.name;
      audio.src = `https://www.googleapis.com/drive/v3/files/${track.id}?alt=media&key=${apiKey}`;
      audio.play();
    }

    function nextTrack() {
      currentTrack = (currentTrack + 1) % tracks.length;
      playTrack(currentTrack);
    }

    function prevTrack() {
      currentTrack = (currentTrack - 1 + tracks.length) % tracks.length;
      playTrack(currentTrack);
    }

    async function loadAllTracks() {
      let pageToken = '', allFiles = [];
      try {
        do {
          const query = encodeURIComponent(`'${folderId}' in parents and (mimeType contains 'audio')`);
          const url = `https://www.googleapis.com/drive/v3/files?q=${query}&fields=files(id,name),nextPageToken&pageSize=100&key=${apiKey}${pageToken ? `&pageToken=${pageToken}` : ''}`;
          const res = await fetch(url);
          const data = await res.json();
          if (data.files) allFiles = allFiles.concat(data.files);
          pageToken = data.nextPageToken;
        } while (pageToken);
        allFiles.sort((a, b) => a.name.localeCompare(b.name));
        tracks = allFiles;
        renderTracks();
      } catch (err) {
        console.error(err);
      }
    }
  </script>
</body>
</html>
